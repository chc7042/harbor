# PRD: Jenkins 빌드 아티팩트 다운로드 기능 수정

## 1. Introduction/Overview

Harbor 시스템의 Jenkins 빌드 아티팩트 다운로드 기능이 현재 모든 버전에서 작동하지 않는 문제를 해결해야 합니다. 사용자들이 NAS에 저장된 빌드 파일들을 웹 인터페이스를 통해 안전하고 안정적으로 다운로드할 수 있도록 하는 것이 목표입니다.

**핵심 문제**: 2.0.0 버전을 포함한 모든 버전의 파일 다운로드가 실패하며, 다양한 에러 메시지(401 Unauthorized, 404 Not Found, "다운로드중 오류가 발생했습니다", 무반응)가 발생합니다.

## 2. Goals

1. **모든 버전의 빌드 아티팩트 다운로드 기능 복구**
2. **대용량 파일(2GB 이하) 안정적 다운로드 지원**
3. **LDAP 인증 기반 보안 다운로드 구현**
4. **사용자 친화적인 다운로드 경험 제공** (진행률 표시, 명확한 에러 메시지)
5. **NAS SMB 공유와의 안정적인 연동**

## 3. User Stories

### US1: 개발자 파일 다운로드
**As a** 개발자  
**I want to** 특정 버전의 빌드 아티팩트를 다운로드  
**So that** 로컬에서 테스트하거나 배포에 사용할 수 있다

### US2: QA 엔지니어 테스트 파일 획득
**As a** QA 엔지니어  
**I want to** 다양한 버전의 빌드 파일을 쉽게 다운로드  
**So that** 버전별 테스트를 수행할 수 있다

### US3: DevOps 엔지니어 배포 아티팩트 관리
**As a** DevOps 엔지니어  
**I want to** 안정적으로 대용량 빌드 파일을 다운로드  
**So that** 프로덕션 배포를 위한 아티팩트를 확보할 수 있다

### US4: 팀 멤버 에러 처리 이해
**As a** 모든 팀 멤버  
**I want to** 다운로드 실패 시 명확한 에러 메시지 확인  
**So that** 문제를 이해하고 적절한 조치를 취할 수 있다

## 4. Functional Requirements

### 4.1 인증 및 권한
1. **FR-1**: 시스템은 LDAP 인증된 사용자만 파일 다운로드를 허용해야 한다
2. **FR-2**: 시스템은 JWT 토큰을 통해 API 호출 시 사용자 인증을 검증해야 한다
3. **FR-3**: 인증 실패 시 명확한 401 Unauthorized 메시지를 표시해야 한다

### 4.2 파일 접근 및 경로 처리
4. **FR-4**: 시스템은 NAS SMB 공유에서 올바른 파일 경로를 동적으로 구성해야 한다
5. **FR-5**: 시스템은 Jenkins 빌드 데이터에서 정확한 버전 정보를 추출해야 한다
6. **FR-6**: 시스템은 파일 존재 여부를 사전 검증하고 404 에러를 방지해야 한다

### 4.3 다운로드 기능
7. **FR-7**: 시스템은 최대 2GB 크기의 파일 다운로드를 지원해야 한다
8. **FR-8**: 시스템은 파일 크기에 비례한 적절한 타임아웃을 설정해야 한다
9. **FR-9**: 시스템은 다운로드 진행률을 사용자에게 표시해야 한다
10. **FR-10**: 시스템은 네트워크 오류 시 재시도 메커니즘을 제공해야 한다

### 4.4 에러 처리 및 사용자 경험
11. **FR-11**: 시스템은 다운로드 실패 시 구체적인 에러 메시지를 제공해야 한다
    - 인증 오류: "로그인이 필요합니다"
    - 파일 없음: "파일을 찾을 수 없습니다"
    - 네트워크 오류: "네트워크 오류가 발생했습니다. 다시 시도해주세요"
    - 권한 오류: "파일에 접근할 권한이 없습니다"
12. **FR-12**: 시스템은 다운로드 시작 전 파일 정보(크기, 이름)를 표시해야 한다
13. **FR-13**: 시스템은 다운로드 취소 기능을 제공해야 한다

### 4.5 버전 호환성
14. **FR-14**: 시스템은 모든 기존 버전(1.0.0, 1.2.0, 2.0.0, 3.0.0 등)의 파일 다운로드를 지원해야 한다
15. **FR-15**: 시스템은 향후 새로운 버전의 파일도 자동으로 지원해야 한다

## 5. Non-Goals (Out of Scope)

1. **NG-1**: 2GB를 초과하는 파일 다운로드 지원
2. **NG-2**: 파일 업로드 기능 개발
3. **NG-3**: 파일 미리보기 또는 편집 기능
4. **NG-4**: 다중 파일 일괄 다운로드 (zip 압축)
5. **NG-5**: 파일 버전 관리 기능
6. **NG-6**: 외부 클라우드 스토리지 통합

## 6. Design Considerations

### 6.1 UI/UX 요구사항
- **다운로드 버튼**: 파일 존재 여부에 따라 활성화/비활성화
- **진행률 바**: 다운로드 진행 상황 실시간 표시
- **에러 모달**: 친화적인 에러 메시지와 해결 방법 제시
- **로딩 상태**: 파일 검증 중 로딩 스피너 표시

### 6.2 기존 컴포넌트 활용
- `ProjectDetailModal`: 다운로드 버튼 및 상태 표시
- `FileUploader`: 진행률 표시 로직 재사용
- `DeploymentTable`: 파일 상태 아이콘 표시

## 7. Technical Considerations

### 7.1 백엔드 아키텍처
- **인증 미들웨어**: 모든 파일 다운로드 라우트에 JWT 검증 적용
- **NAS 서비스**: SMB 클라이언트를 통한 안정적인 파일 스트리밍
- **경로 서비스**: 동적 파일 경로 구성 및 검증
- **에러 핸들링**: 구조화된 에러 응답 및 로깅

### 7.2 프론트엔드 아키텍처
- **API 서비스**: Axios 기반 인증된 파일 다운로드
- **상태 관리**: 다운로드 진행 상태 및 에러 상태 관리
- **에러 바운더리**: 예상치 못한 에러 처리

### 7.3 인프라 고려사항
- **타임아웃 설정**: 파일 크기별 적응적 타임아웃
- **재시도 로직**: 네트워크 불안정성 대응
- **로깅**: 다운로드 실패 원인 추적을 위한 상세 로깅

## 8. Success Metrics

### 8.1 기능적 성공 지표
- **다운로드 성공률**: 95% 이상
- **모든 버전 지원**: 1.0.0, 1.2.0, 2.0.0, 3.0.0 등 100% 지원
- **에러 해결률**: 명확한 에러 메시지를 통한 사용자 자가 해결 80% 이상

### 8.2 성능 지표
- **파일 검증 시간**: 5초 이내
- **다운로드 시작 시간**: 사용자 클릭 후 10초 이내
- **대용량 파일 안정성**: 1GB 이상 파일 95% 성공률

### 8.3 사용자 경험 지표
- **에러 메시지 만족도**: 사용자 피드백 기반 평가
- **다운로드 프로세스 직관성**: 추가 안내 없이 사용 가능

## 9. Open Questions

### 9.1 기술적 질문
1. **Q1**: NAS SMB 공유의 정확한 디렉토리 구조는 무엇인가?
2. **Q2**: Jenkins 빌드 데이터에서 파일 경로 정보를 어떻게 추출하는가?
3. **Q3**: 현재 사용 중인 JWT 토큰의 만료 시간과 갱신 정책은?

### 9.2 비즈니스 질문
4. **Q4**: 다운로드 실패 시 알림이나 로깅이 필요한가?
5. **Q5**: 특정 역할(개발자, QA 등)별로 접근 가능한 파일을 제한해야 하는가?

### 9.3 운영 질문
6. **Q6**: 다운로드 통계나 사용량 추적이 필요한가?
7. **Q7**: 동시 다운로드 사용자 수 제한이 필요한가?

---

## Implementation Priority

### Phase 1: 핵심 기능 복구 (High Priority)
- 인증 문제 해결
- 파일 경로 동적 구성
- 기본 다운로드 기능

### Phase 2: 사용자 경험 개선 (Medium Priority)
- 진행률 표시
- 에러 메시지 개선
- 파일 정보 표시

### Phase 3: 안정성 향상 (Low Priority)
- 재시도 메커니즘
- 대용량 파일 최적화
- 성능 모니터링