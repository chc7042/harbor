# Product Requirements Document: NAS 스캔 결과 데이터베이스 저장

## Introduction/Overview

현재 Harbor 시스템은 15분마다 NAS를 스캔하여 Jenkins 배포 파일들을 확인하고 있습니다. 하지만 한번 배포된 빌드 아티팩트는 변경되지 않는 특성상, 동일한 파일들을 반복적으로 스캔하는 것은 불필요한 리소스 낭비입니다.

이 기능은 NAS 스캔 결과를 데이터베이스에 저장하여, 향후 중복 스캔을 방지하고 시스템 성능을 개선하기 위한 첫 번째 단계입니다.

## Goals

1. NAS 스캔 시 발견된 파일 정보를 데이터베이스에 저장
2. 기존 NAS 스캔 로직을 변경하지 않고 저장 기능만 추가
3. 향후 스마트 캐싱 시스템의 기반 데이터 구축

## User Stories

1. **시스템 관리자로서**, NAS 스캔 결과가 데이터베이스에 누적되어 파일 이력을 추적할 수 있기를 원합니다.

2. **개발자로서**, 특정 파일이 언제 처음 발견되었는지 데이터베이스에서 확인할 수 있기를 원합니다.

3. **시스템으로서**, 스캔된 파일 정보를 저장하여 향후 중복 스캔을 방지할 수 있는 기반을 마련하기를 원합니다.

## Functional Requirements

1. **스캔 결과 저장**: NAS 스캔 시 발견된 각 파일에 대해 다음 정보를 `nas_files` 테이블에 저장해야 합니다:
   - 파일 경로 (상대 경로)
   - 파일명
   - 파일 크기
   - 마지막 수정 시간
   - 스캔 시점 (created_at)

2. **중복 방지**: 동일한 파일 경로에 대해서는 한 번만 저장하고, 이후 스캔에서는 업데이트만 수행해야 합니다.

3. **기존 로직 보존**: 현재 NAS 스캔 로직과 스케줄링(15분 간격)은 변경하지 않습니다.

4. **로깅 추가**: 저장된 파일 수와 업데이트된 파일 수를 로그에 기록해야 합니다.

## Non-Goals (Out of Scope)

1. NAS 스캔 로직 최적화나 스케줄링 변경
2. 저장된 데이터를 활용한 캐싱 로직 구현
3. 프론트엔드 UI 변경
4. 데이터베이스 마이그레이션 (기존 `nas_files` 테이블 활용)

## Technical Considerations

1. **기존 테이블 활용**: 현재 `nas_files` 테이블이 존재하므로 이를 활용합니다.
2. **NAS 서비스 확장**: `backend/src/services/nasService.js`에 저장 기능을 추가합니다.
3. **배치 처리**: 스캔 완료 후 일괄적으로 데이터베이스에 저장하여 성능을 최적화합니다.
4. **에러 처리**: 데이터베이스 저장 실패 시에도 기존 스캔 기능에 영향을 주지 않도록 합니다.

## Success Metrics

1. NAS 스캔 시 발견된 파일 100%가 데이터베이스에 저장됨
2. 기존 NAS 스캔 성능에 영향 없음 (±5% 이내)
3. 데이터베이스 저장 실패율 1% 미만

## Implementation Notes

1. **최소 변경**: 기존 `nasService.js`의 스캔 로직 마지막에 저장 함수만 추가
2. **안전한 저장**: `try-catch`로 감싸서 저장 실패가 스캔에 영향주지 않도록 처리
3. **점진적 개선**: 이 기능이 안정화된 후 다음 단계로 스마트 캐싱 구현

## Open Questions

1. 파일이 삭제된 경우 데이터베이스에서도 제거해야 하는가? (현재는 유지)
2. 로그 레벨은 어느 정도로 설정할 것인가? (INFO vs DEBUG)